


<!DOCTYPE html>
<html>
<title>Web Scraping - Database</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?

family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-

awesome/4.7.0/css/font-awesome.min.css">
<style>
body, h1,h2,h3,h4,h5,h6 {font-family: "Montserrat", sans-serif}

body, html {
  height: 100%;
  color: #000000;
}

/* Create a Parallax Effect */
.bgimg-1 {
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  background-image: url('https://je-suis-tm.github.io/img/background.jpg');
  min-height:160%;
}

.w3-panel {
  margin-top:-15%;
}
</style>
  
<head>
  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/je-suis-tm/je-suis-tm.github.io/master/img/favicon.ico" />
</head>
<body class="w3-black">


<!-- Navbar -->

<div >
<div class="w3-row w3-large w3-black" >  

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#" class="w3-block w3-button ">
HOME&emsp;<i class="fa fa-home w3-xxlarge w3-xxlarge w3-center"></i></a>
</div>      

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#recent" class="w3-block w3-button ">
RECENT&emsp;<i class="fa fa-newspaper-o w3-xxlarge w3-center"></i></a>
</div>
  
<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#upcoming" class="w3-block w3-button ">
UPCOMING&emsp;<i class="fa fa-rocket w3-xxlarge w3-center"></i></a>
</div> 

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#about" class="w3-block w3-button ">
ABOUT&emsp;<i class="fa fa-trademark w3-xxlarge w3-center"></i></a>
</div>

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#contact" class="w3-block w3-button ">
CONTACT&emsp;<i class="fa fa-send w3-xxlarge w3-center"></i></a>
</div>

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/archive" class="w3-block w3-button ">
ARCHIVE&emsp;<i class="fa fa-briefcase w3-xxlarge w3-center"></i></a>
</div>

</div>
</div>
</div>


<!-- Navbar on small screens (remove the onclick attribute if you want the 

navbar to always show on top of the content when clicking on the links) -->
<div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-

medium w3-top" style="margin-top:46px">
  <a href="https://je-suis-tm.github.io" class="w3-bar-item w3-button w3-

padding-large" >HOME</a>
  <a href="https://je-suis-tm.github.io/#recent" class="w3-bar-item w3-button w3

-padding-large" >RECENT</a>
  <a href="https://je-suis-tm.github.io/#upcoming" class="w3-bar-item w3-button 

w3-padding-large" >UPCOMING</a>
  <a href="https://je-suis-tm.github.io/#about" class="w3-bar-item w3-button w3-

padding-large" >ABOUT</a>
  <a href="https://je-suis-tm.github.io#contact" class="w3-bar-item w3-button w3

-padding-large" >CONTACT</a>
</div>


<!-- Header/Home -->
  
<div class="bgimg-1 w3-display-container">
  <div class="w3-panel w3-display-middle">
    <div class="w3-opacity-min w3-center">
    <span class="w3-xxxlarge w3-text-white w3-wide ">T.M.
    </div>
    <div class="w3-opacity-min w3-center">
    <span class="w3-large w3-text-white ">Half Researcher, Half Developer.</span></div>
  </div>  
</div>



<!-- Page Content -->
  <!-- The Main Section -->
<div class="w3-container w3-black w3-centre w3-margin-top" >
<div class="w3-container w3-white w3-content w3-justify w3-margin-top" >
    <h2 class="w3-wide">Database</h2>

<br>

<p class="w3-justify">Why do we need database?</p>

<p class="w3-justify">There are many reasons for a big organization. For an individual user like us, the biggest advantage is, EFFICIENCY. Assume a website publishes data every day and you need consistent time series to run some models. For economic reasons, we only need to scrape the latest report each day in theory. What if one report gets delayed by some 'technical issues' (usually this is a lame excuse)? We have to scrape two reports next day. But we cannot keep track of everything every day and machines are supposed to do the grunt work for us. If we scrape the entire historical dataset as an alternative, it will take too much time and computing capacity. Additionally, we are running a risk of being blacklisted by the website. Some of those APIs even implement daily limit for each user. This is when database kicks in and keep tracks of everything. With records in the database, we can always start from where we left off last time. Of course, there are many other benefits of database, e.g. Data Integrity, Data Management.</p>

<p class="w3-justify">Enough of sales pitch, let's get into the technical details of database. The package we installed is called sqlite3, referring to SQLite database. The setup of SQLite database is hassle-free, in contrast to other relational database such as MySQL or PostgreSQL. Other benefits of SQLite include rapide execution, petit size. Since we are not running a big organization, we shouldn't be bothered with things like Azure, SQL server or Mongo DB.</p>

<p class="w3-justify">To create a database, we simply do</p>

<p class="w3-justify">

<code class="w3-codespan">conn = sqlite3.connect('database.db')</code>

<br>

<code class="w3-codespan">c = conn.cursor()</code>

<br>

</p>

<p class="w3-justify">The above command would create a database if it does not exist in a given directory. If it exists, it will automatically connect to the database instead. </p>

<p class="w3-justify">If you are connecting to corporate server, you might consider the following <a href=https://docs.microsoft.com/en-us/sql/connect/python/pyodbc/step-3-proof-of-concept-connecting-to-sql-using-pyodbc>tutorial</a> on <span style="background-color: #f2ece1;">pyodbc</span>. To connect to SQL server, simply do</p>

<p class="w3-justify">

<code class="w3-codespan">import pyodbc</code>

<br>

<code class="w3-codespan">conn = pyodbc.connect('DRIVER={SQL Server};SERVER=some_ip_address;DATABASE=some_database_name;UID=some_username;PWD=some_password')</code>

<br>

<code class="w3-codespan">c = conn.cursor()</code>

<br>

</p>

<p class="w3-justify">Next step is to create a table in the database, we can do</p>

<p class="w3-justify">

<code class="w3-codespan">c.execute("CREATE TABLE table_name ([column1] DATATYPE, [column2] DATATYPE, [column3] DATATYPE, PRIMARY KEY ([column1], [column2], [column3]));")</code>

<br>

<code class="w3-codespan">conn.commit()</code>

<br>

</p>

<p class="w3-justify">Some key notes</p>

<ul>

<li> An interesting feature of SQL is its case insensitivity. Still, the upper case letters make things more distinguishable. The brackets <span style="background-color: #f2ece1;">[]</span> serve the same purpose.</li>

<li> For some reason, sqlite3 requests <span style="background-color: #f2ece1;">;</span> at the end of each SQL command.</li>

<li> Always remember to commit changes to database. Think of it as a pop up window to ask you if you want to save all the changes and you click HELL YEAH.</li>

<li> The data types in SQL are very sophisticated and precise. Unless your duty is to maintain the efficiency of the database, I'd suggest you go with python data types such as 'FLOAT','DATE','TEXT'.</li>

<li> Primary key is crucial to your data integrity. Primary key guarantees the uniqueness of the datasets. For instance, if the website modifies one historical data point, without the primary key constraint, we could end up with two values for the same period. With the primary key constraint, we can update the old value to skip any data corruption. </li>

<li> Only one primary key is allowed in each table (or no primary key at all). Even though, primary key can involve multiple columns, like the above statement.</li>

</ul>

<p class="w3-justify">Now that tables are set up, let's insert some scraped data into the database, we can do</p>

<p class="w3-justify">

<code class="w3-codespan">c.execute("INSERT INTO table_name VALUES (?,?,?,?)",[data1,data2,data3,data4])</code>

<br>

<code class="w3-codespan">conn.commit()</code>

<br>

<code class="w3-codespan">conn.close()</code>

<br>

</p>

<p class="w3-justify">We should not forget the last statement. SQLite3 database does not allow multiple modification at the same time. Other users cannot make changes inside the table if we don't close the database, similar to Excel in a way.</p>

<p class="w3-justify">To make query directly from database, we do</p>

<p class="w3-justify">

<code class="w3-codespan">c=conn.cursor()</code>

<br>

<code class="w3-codespan">c.execute("SELECT * FROM table_name WHERE [column1]=value1;")</code>

<br>

<code class="w3-codespan">rows=c.fetchall()</code>

<br>

<code class="w3-codespan">conn.commit()</code>

<br>

</p>

<p class="w3-justify">The above is a conventional query method in sqlite3. However, pandas provide a much more convenient way. The output goes straight into dataframe instead of tuples within a list. Easy peasy lemon squeezy! </p>

<p class="w3-justify">

<code class="w3-codespan">df=pd.read_sql("SELECT * FROM table_name WHERE [column1]=value1",conn)</code>

<br>

</p>

<p class="w3-justify">One of the very common issues from query is encoding. Unfortunately, I haven't managed to solve it so far. Though there is a way to get around like this</p>

<p class="w3-justify">

<code class="w3-codespan">'C'était des loques qui se traînaient'.encode('latin-1').decode('ISO-8859-1')</code>

<br>

</p>

<p class="w3-justify">There are other useful SQL sentences as well. For more details, you can check <a href=https://www.w3schools.com/sql>w3schools</a>. I personally believe fluency in <span style="background-color: #f2ece1;">SELECT</span>, <span style="background-color: #f2ece1;">DELETE</span>, <span style="background-color: #f2ece1;">UPDATE</span> and <span style="background-color: #f2ece1;">INSERT</span> is enough to cover most of your daily tasks, unless you aim to be a data architect dealing with numerous schemas.</p>

<p class="w3-justify">Some other useful statements including</p>

<p class="w3-justify">

<code class="w3-codespan">UPDATE table_name SET [column1]=value1</code>

<br>

<code class="w3-codespan">DELETE FROM table_name WHERE [column1]=value1</code>

<br>

</p>

<p class="w3-justify">Feel free to take a look at <a href= https://github.com/je-suis-tm/web-scraping/blob/master/LME.py>LME</a> for more coding details.</p>
    <br>
    <br>
    <p>Click the icon below to be redirected to GitHub Repository</p>
    <a href="https://github.com/je-suis-tm/web-scraping#2-database-lme" target="_blank"><i class="fa fa-github-alt fa-fw w3-

xxlarge"></i></a>
  <!-- End Main Section -->   
</div>	  
</div>
</body>
<hr> 
  
  <!-- Footer -->
  <footer class="w3-container w3-card w3-black w3-margin-bottom">
    <a href="https://github.com/je-suis-tm" target="_blank"><i class="fa fa-

github-square w3-hover-opacity"></i></a>
    <i class="fa fa-linkedin-square w3-hover-opacity"></i>
    <i class="fa fa-facebook-square w3-hover-opacity"></i>
    <i class="fa fa-twitter-square w3-hover-opacity"></i>
    <i class="fa fa-whatsapp w3-hover-opacity"></i>
    <i class="fa fa-snapchat-square w3-hover-opacity"></i>
    <p class="w3-small">I can change the footer, but this template is really 

fabulous, it is powered by <a href="https://www.w3schools.com/w3css/default.asp" 

target="_blank" class="w3-hover-text-green">w3.css</a></p>
  <!-- End footer -->
  </footer>

<!-- END PAGE CONTENT -->
</html>
