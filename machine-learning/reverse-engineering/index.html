
<!DOCTYPE html>
<html>
<title>Machine Learning - Reverse Engineering</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?

family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-

awesome/4.7.0/css/font-awesome.min.css">
<style>
body, h1,h2,h3,h4,h5,h6 {font-family: "Montserrat", sans-serif}

body, html {
  height: 100%;
  color: #000000;
}

/* Create a Parallax Effect */
.bgimg-1 {
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  background-image: url('https://je-suis-tm.github.io/img/background.jpg');
  min-height:160%;
}

.w3-panel {
  margin-top:-15%;
}
</style>
  
<head>
  <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/je-suis-tm/je-suis-tm.github.io/master/img/favicon.ico" />
</head>
<body class="w3-black">


<!-- Navbar -->

<div >
<div class="w3-row w3-large w3-black" >  

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#" class="w3-block w3-button ">
HOME&emsp;<i class="fa fa-home w3-xxlarge w3-xxlarge w3-center"></i></a>
</div>      

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#recent" class="w3-block w3-button ">
RECENT&emsp;<i class="fa fa-newspaper-o w3-xxlarge w3-center"></i></a>
</div>
  
<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#upcoming" class="w3-block w3-button ">
UPCOMING&emsp;<i class="fa fa-rocket w3-xxlarge w3-center"></i></a>
</div> 

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#about" class="w3-block w3-button ">
ABOUT&emsp;<i class="fa fa-trademark w3-xxlarge w3-center"></i></a>
</div>

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/#contact" class="w3-block w3-button ">
CONTACT&emsp;<i class="fa fa-send w3-xxlarge w3-center"></i></a>
</div>

<div class="w3-col s2">
<a href="https://je-suis-tm.github.io/archive" class="w3-block w3-button ">
ARCHIVE&emsp;<i class="fa fa-briefcase w3-xxlarge w3-center"></i></a>
</div>

</div>
</div>
</div>


<!-- Navbar on small screens (remove the onclick attribute if you want the 

navbar to always show on top of the content when clicking on the links) -->
<div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-

medium w3-top" style="margin-top:46px">
  <a href="https://je-suis-tm.github.io" class="w3-bar-item w3-button w3-

padding-large" >HOME</a>
  <a href="https://je-suis-tm.github.io/#recent" class="w3-bar-item w3-button w3

-padding-large" >RECENT</a>
  <a href="https://je-suis-tm.github.io/#upcoming" class="w3-bar-item w3-button 

w3-padding-large" >UPCOMING</a>
  <a href="https://je-suis-tm.github.io/#about" class="w3-bar-item w3-button w3-

padding-large" >ABOUT</a>
  <a href="https://je-suis-tm.github.io#contact" class="w3-bar-item w3-button w3

-padding-large" >CONTACT</a>
</div>


<!-- Header/Home -->
  
<div class="bgimg-1 w3-display-container">
  <div class="w3-panel w3-display-middle">
    <div class="w3-opacity-min w3-center">
    <span class="w3-xxxlarge w3-text-white w3-wide ">T.M.
    </div>
    <div class="w3-opacity-min w3-center">
    <span class="w3-large w3-text-white ">Half Researcher, Half Developer.</span></div>
  </div>  
</div>



<!-- Page Content -->
  <!-- The Main Section -->
<div class="w3-container w3-black w3-centre w3-margin-top" >
<div class="w3-container w3-white w3-content w3-justify w3-margin-top" >
  
    <br>

<h2 class="w3-wide">Reverse Engineering</h2>

<br>&nbsp;<br>

<hr>

<br>

<h3 id="table-of-contents">Table of Contents</h3>

<br>

<ul>

<li> <a href=#intro>Intro</a>

</li>

</ul>

<ul>

<li> <a href=#centroid-model>Centroid Model</a>

</li>

</ul>

<ul>

<li> <a href=#distribution-model>Distribution Model</a>

</li>

</ul>

<ul>

<li> <a href=#density-model>Density Model</a>

</li>

</ul>

<br>

<hr>&nbsp;<br>

<h3 id="intro">Intro</h3>

<br>

<p class="w3-justify">Creating a visualization from data is easy. In Tableau, it's only one click. What happens if you want to extract data from a visualization? A simple google search yields a few reverse engineering tools, yet they share the same malaise – they only work with single curve and require a lot of clicks. This project addresses these issues by incorporating unsupervised learning into image processing. Multiple curves are separated by different color channels with clustering techniques. Data can be easily extracted via computing coordinates of each pixel. A simple conversion from resolution scale to axis scale approximates the coordinates to the original spreadsheet. Voila, no more ridiculous subscription to Statista &#x1f632;</p>

<p class="w3-justify">Well, that may be a bit exaggerating. According to the second law in thermodynamics, heat naturally flows from hotter to colder bodies unless external influence is forced upon the system (tenet, anyone?). The same applies to our reverse engineering process. The irreversibility in visualization generating process determines that we would never be able to replicate the original spreadsheet. At best, we are only able to replicate the same data in the scale of the resolution. It is a consequence of the asymmetric character of image processing operations. Regardless of its limitation, it is still a great tool to capture the overall trend and rough numbers. Use it when subscription to data provider is not a commercially viable option and the requirement of the precision is of less importance.</p>

<p class="w3-justify">Let’s introduce two guinea pigs of this project, a bar chart and a line chart. The bar chart comes from my <a href=https://github.com/je-suis-tm/graph-theory/blob/master/Epidemic%20Outbreak%20project>Epidemic Outbreak</a> project. It is a degree distribution of both Barabási-Albert model and Erdős-Rényi model with the same mean degree. The real challenge lies at the overlap part of grey bars and orange bars. We need to find an algorithm to separate the grey bars from the orange bars so that we can compute the coordinates of the underlying pixels.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/graph-theory/master/Epidemic%20Outbreak%20project/preview/graph-degree%20distribution.png" class="w3-image" width="600" height="450">

<p class="w3-justify">Since we are only interested in the data “behind the bars”, we need to remove the legend, the title and the axis labels. The input should be reduced to an image fitted to the scale of the axis.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/bar%20chart.png" class="w3-image" width="600" height="450">

<p class="w3-justify">The line chart comes from my <a href=https://github.com/je-suis-tm/quant-trading/tree/master/Smart%20Farmers%20project>Smart Farmer</a> project. It is the comparison between palm oil FFB forecast and palm oil CPO forward curve. The overlap of the lines is no concern, but the tricky part is the dotted line. We need to carefully calibrate the parameters of erosion and dilation algorithm in order to preserve the inclusion of the dotted line. Without delicate balance, the dotted line could easily become noise.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/quant-trading/master/Smart%20Farmers%20project/preview/oil%20palm%20vs%20palm%20oil.png" class="w3-image" width="600" height="450">

<p class="w3-justify">Similar to the bar chart, the line chart has to be cleansed into a purest form without extra information.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/line%20chart.png" class="w3-image" width="600" height="450">

<p class="w3-justify">We have been taught digital images comprise of many pixels in school. The color of each pixel is represented in RGB values. Each pixel is assigned to a unique position in a 2D matrix with the same size of the resolution. Ideally, the green color in RGB is (0,255,0). A search in the matrix for all the pixels equal to (0,255,0) should yield the coordinates. Palm oil CPO forward curve should be obtained. How I wish it is that easy &#x1f612;</p>

<p class="w3-justify">The brutal truth is the green color in the line chart can range from (0,255,0) to (20,230,20) or even more dramatic. Eyes of Homo Sapiens are almost at the bottom of the food chain (I would love to see infrared and ultraviolet!). The tiny difference between (0,255,0) green and (1,255,0) green cannot be detected by our humble eyes but machines pick it up effortlessly. Yet, RGB values create 2^24 combinations of colors. Here comes haute couture. How do we separate the RGB colors wisely in order to separate the multiple lines?</p>

<br>

<h3 id="centroid-model">Centroid Model</h3>

<br>

<p class="w3-justify">Well, the answer is unsupervised learning. How? This project draws inspiration from question 5 of problem set 3 of Stanford University CS229. If you don’t bother to find it in your course materials, that’s fine. Basically, the problem set attempts to apply <a href=https://github.com/je-suis-tm/machine-learning/blob/master/k%20means.ipynb>K Means</a> to lossy image compression, by reducing the number of colors used in an image. Each pixel in the image is considered a data point in the RGB 3D space. We create a fixed number of clusters and replace each pixel with the closest cluster centroid. Ultimately, we end up with fixed number of colors.</p>

<p class="w3-justify">In regard to our project, multiple lines are conventionally rendered in different colors. Same color with different line styles rarely occurs since it’s easy to confuse the audience. To separate multiple lines is equivalent to separate multiple colors. Translated to Lingua Franco in machine learning, we need the optimal number of clusters to substitute each pixel with the closest centroid. When words like “optimal” appear given the condition of “K Means”, things like “elbow method”, “silhouette score” and “gap statistics” should emerge. Apparently, elbow method is the prime choice for us due to its smaller time complexity. </p>

<p class="w3-justify">The image below is the decomposition of bar chart by elbow method. Regrettably, the overlapped part is identified as an extra cluster. The ideal number of clusters should be number of bars plus the background color, which is three.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20bar%20elbow%20method.png" class="w3-image" width="600" height="450">

<p class="w3-justify">As the hyperparameters are always arbitrary, we have to rely on human intuition to calibrate the model. We plug in the magic number three and here we go. We keep the orange bars away from the grey bars.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20bar%20kmeans.png" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/bar%20rendered1%20kmeans.png" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/bar%20rendered2%20kmeans.png" class="w3-image" width="600" height="450">

<p class="w3-justify">Once different colors are separated, the rest of the operations become a lot easier. Images are represented in a <span style="background-color: #f2ece1;">numpy</span> 2D matrix in <span style="background-color: #f2ece1;">opencv2</span>. Decomposed images are filtered into black and white where the target is white and the rest is black. We can do a simple iteration to locate the row and column number of all the white elements in the matrix. Because the coordinates of these elements only reflect where they are in the image, a conversion from resolution scale to axis scale is necessary. For instance, the image has width and height of 100 but the actual X and Y axis ranges from -1 to 1. The coordinate of (10,20) should be converted into (0.2,0.4). Each number has to time the conversion factor (1-(-1))/100.</p>

<p class="w3-justify">Last but not least, the data we obtain requires compression before usage. The compression works on both horizontal and vertical directions. From the vertical perspective, only the very top of the bar contains useful information. We merely fill anything below with the same color for the sake of aesthetics. Thus, only maximum Y value is kept given the same X value in the bar chart. In line chart, the median Y value is kept. From the horizontal perspective, the conversion from resolution scale to axis scale is insufficient. The size of the data must be shrunk from resolution scale to actual scale. For instance, the width of the image is 100. The actual data ranges from 1 to 10 with 10 data points. A straightforward way would be using double colon extended slices to take every tenth number. However, this approach largely ignores the nature of the cluster. The allocation of Y values may lean heavily towards the highly dense area. I propose the alternative way, which is based upon the minimum absolute error. For instance, we need to take two values from <span style="background-color: #f2ece1;">[1.1,1.2,1.3,1.4,1.5,1.7,1.9,2.1]</span>. Say the expected value is <span style="background-color: #f2ece1;">[1,2]</span>. <span style="background-color: #f2ece1;">[::4]</span> expression yields <span style="background-color: #f2ece1;">[1.1,1.5]</span>. Minimum absolute error approach yields <span style="background-color: #f2ece1;">[1.1,1.9]</span> because 1.1 and 1.9 has the smallest error against <span style="background-color: #f2ece1;">[1,2]</span>. Although in this particular case of bar chart, the horizontal compression is rather difficult due to the lack of visibility on the mean degree distribution of random graph models. The horizontal compression makes more sense in the line chart as you would’ve seen later.</p>

<p class="w3-justify">Now we reverse engineer the visualization of mean degree distribution. As no information is lost, I can confidently say the entropy doesn’t increase at all &#x1f44f;</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/bar%20chart%20re%20kmeans.png" class="w3-image" width="600" height="450">

<p class="w3-justify">Let’s formally define the process of reverse engineering bar chart. The procedure is identical as the bar chart.</p>

<ul>

<li> Préparation</li>

<li> Décomposition</li>

<li> Triangulation</li>

<li> Conversion</li>

<li> Compression</li>

</ul>

<p class="w3-justify">When it comes to the second lab rat, additional steps are taken in the preprocessing. The erosion is required to connect dotted line into a solid line. It makes triangulation of the coordinates a lot easier.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/line%20erosion1.png" class="w3-image" width="600" height="450">

<p class="w3-justify">As usual, we would love to use elbow method to identify the optimal number of clusters. To our disappointment, elbow method never seems to work on the challenging part. As you can see in the notebook, only 3 clusters are identified and the connected dotted line gets the noise treatment. The objective of automation fails miserably. Hence, we manually input the magic number four, which is numbers of lines plus the background color. Abracadabra &#x1f61b;</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20line%20kmeans.png" class="w3-image" width="600" height="450">

<p class="w3-justify">If you check the bottom right carefully, you’d notice the large amount of noise coinciding with the connected dotted line. They seem to be the edge color of red and green lines. Needless to say, erosion has to be performed to cleanse the decomposed image.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/line%20erosion2%20kmeans.png" class="w3-image" width="600" height="450">

<p class="w3-justify">The rest of the operation is the same as the bar chart. In this case, the horizontal compression is performed on the line chart and increases the entropy. The reconstructed line chart demonstrates a tiny bit of difference in the slope, although almost unrecognizable by human eyes. </p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/line%20chart%20re%20%20kmeans.png" class="w3-image" width="600" height="450">

<br>

<h3 id="distribution-model">Distribution Model</h3>

<br>

<p class="w3-justify">Theoretically, K Means is a special case of expectation maximization algorithm. The computation of the new centroid is considered as E step. The label update of the underlying data points is considered as M step. In this chapter, we intend to examine the generalized case. One of the most common models powered by EM algorithm is <a href=https://github.com/je-suis-tm/machine-learning/blob/master/gaussian%20mixture%20model.ipynb>Gaussian Mixture Model</a>. Since GMM studies the mixture of different Gaussian distributions, GMM has the magic to untangle the overlapped area where the result may point to multiple distributions. We cannot stop to wonder whether GMM provides a better solution to the bar chart. </p>

<p class="w3-justify">On the other hand, GMM doesn’t come without its caveat. Similar to K Means, GMM requires the hyper-parameter – number of clusters. Aside from that, the initial value of GMM is more complex. Instead of several random centroids, GMM requires mean, standard variation and weight of each distribution to kick start. A quick start of GMM requires the initial result from K Means. Then GMM merely focuses on the intersection of different clusters to create clear cut boundaries.</p>

<p class="w3-justify">To select optimal number of clusters, GMM can borrow Akaike Information Criterion and Bayesian Information Criterion from Gaussian distributions. Conventionally, lower AIC or BIC is always better. Nonetheless, I found that global minima of AIC or BIC rarely occurs in many real life applications. Empirically speaking, both AIC and BIC should be taken into account. By taking elbow method to locate the gradient dip, I prefer to take the minimum between AIC-indicated number of clusters and BIC-indicated number of clusters.</p>

<p class="w3-justify">The image below is the decomposition of bar chart by GMM. Undesirably, six clusters have been identified. Many of the clusters are some colors human eyes cannot detect. As I frequently insist, machine learning is a state of art. Without domain knowledge, hyper-parameter tuning is like searching a drop in the ocean.</p>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20bar%20gmm.jpg" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20bar%20dirichlet.jpg" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20line%20gmm.jpg" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/line%20erosion2%20gmm.png" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20line%20dirichlet.jpg" class="w3-image" width="600" height="450">

<br>

<h3 id="density-model">Density Model</h3>

<br>

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20bar%20optics.png" class="w3-image" width="600" height="450">

<br>

<img src="https://raw.githubusercontent.com/je-suis-tm/machine-learning/master/Reverse%20Engineering%20project/preview/color%20channels%20line%20optics.png" class="w3-image" width="600" height="450">
<br>
    <br>
    <br>
    <p>Click the icon below to be redirected to GitHub Repository</p>
    <a href="https://github.com/je-suis-tm/machine-learning/tree/master/Reverse%20Engineering%20project" target="_blank"><i class="fa fa-github-alt fa-fw w3-

xxlarge"></i></a>
  <!-- End Main Section -->   
</div>	  
</div>
</body>
<hr> 
  
  <!-- Footer -->
  <footer class="w3-container w3-card w3-black w3-margin-bottom">
    <a href="https://github.com/je-suis-tm" target="_blank"><i class="fa fa-

github-square w3-hover-opacity"></i></a>
    <i class="fa fa-linkedin-square w3-hover-opacity"></i>
    <i class="fa fa-facebook-square w3-hover-opacity"></i>
    <i class="fa fa-twitter-square w3-hover-opacity"></i>
    <i class="fa fa-whatsapp w3-hover-opacity"></i>
    <i class="fa fa-snapchat-square w3-hover-opacity"></i>
    <p class="w3-small">I can change the footer, but this template is really 

fabulous, it is powered by <a href="https://www.w3schools.com/w3css/default.asp" 

target="_blank" class="w3-hover-text-green">w3.css</a></p>
  <!-- End footer -->
  </footer>

<!-- END PAGE CONTENT -->
</html>
